(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[36],{QbFe:function(e,t,a){"use strict";var i=a("tAuX"),n=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var r=i(a("q1tI"));a("IzEo");var l=n(a("bx4M"));a("P2fV");var d=n(a("NJEC"));a("giR+");var u=n(a("fyUT"));a("/zsF");var c=n(a("PArb"));a("+L6B");var o=n(a("2/Rp"));a("miYZ");var f=n(a("tsqr")),h=n(a("p0pE")),s=n(a("eHn4")),m=n(a("2Taf")),g=n(a("vZ4D")),y=n(a("l4Ni")),p=n(a("ujKo")),W=n(a("MhPg"));a("5NDa");var v=n(a("5rEg"));a("OaEy");var b=n(a("2fM7"));a("y8nQ");var F,k,E,S=n(a("Vl3Y")),I=n(a("ZVTz")),C=n(a("bKel")),B=n(a("3a4m")),j=i(a("+n12")),M=a("DxLx"),q=S["default"].Item,w=b["default"].Option,N=v["default"].TextArea,P=(F=S["default"].create(),(0,C["default"])(k=F((E=function(e){function t(){var e,a;(0,m["default"])(this,t);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return a=(0,y["default"])(this,(e=(0,p["default"])(t)).call.apply(e,[this].concat(n))),a.state={detail:{},devices:[],inHaveConfirm:!1,inButtonState:0,inFactoryWeightByManual:0,inFactoryWeight:null,outHaveConfirm:!1,outButtonState:0,outFactoryWeightByManual:0,outFactoryWeight:null,deductWeight:null,remark:null,samplePushStatus:0,deviceId:null},a.getWeight=function(e){var t=a.props.form.validateFields;t(["deviceId"],function(t,i){!t&&i.deviceId&&(0,M.getWeight)(i.deviceId).then(function(t){var i,n;t&&1===t.code&&("0"===t.object?a.setState((i={},(0,s["default"])(i,"".concat(e,"FactoryWeight"),0),(0,s["default"])(i,"".concat(e,"ButtonState"),2),i)):a.setState((n={},(0,s["default"])(n,"".concat(e,"FactoryWeight"),Number(t.object)),(0,s["default"])(n,"".concat(e,"ButtonState"),1),n)))})})},a.handleWeight=function(e){var t=a.props.location.query.machineId,i=a.state,n=i.detail,r=i.inFactoryWeight,l=i.inFactoryWeightByManual,d=i.outFactoryWeight,u=i.outFactoryWeightByManual,c={machineId:t,type:e,weightType:1};c=1===e?(0,h["default"])({},c,{inFactoryWeight:r,inFactoryWeightByManual:l}):(0,h["default"])({},c,{outFactoryWeight:d,outFactoryWeightByManual:u}),(0,M.confirmWeight)(c).then(function(t){t&&1===t.code&&(f["default"].success(t.message),1===e?a.setState({inButtonState:2,inHaveConfirm:!0,detail:(0,h["default"])({},n,{inFactoryWeight:r})}):a.setState({outButtonState:2,outHaveConfirm:!0,detail:(0,h["default"])({},n,{outFactoryWeight:d})}))})},a.handleSample=function(){var e=a.props.location.query.machineId,t=a.state,i=t.inHaveConfirm,n=t.inFactoryWeight;if(!i)return f["default"].warning("\u8bf7\u5148\u786e\u8ba4\u8fdb\u5382\u79f0\u91cd");if(!n)return f["default"].warning("\u65e0\u8fdb\u5382\u6570\u91cf\uff0c\u65e0\u6cd5\u901a\u77e5\u53d6\u6837");var r=j.queryString({machineId:e,type:1});(0,M.samplePush)(r).then(function(e){e&&1===e.code&&(f["default"].success(e.message),a.setState({samplePushStatus:1}))})},a.saveWeightAndRemark=function(e){var t=a.props.form.validateFields,i=a.props.location.query.machineId,n=!0,r=!0;t(["deductWeight","remark"],function(t,a){if(!t)if(a.deductWeight||0===a.deductWeight){n=!1;var l=j.queryString({machineId:i,type:1,deductWeightByManual:2,deductWeight:a.deductWeight});(0,M.confirmDeductWeight)(l).then(function(t){if(t&&1===t.code)if(n=!0,a.remark){r=!1;var l=j.queryString({machineId:i,type:1,remark:a.remark});(0,M.saveRemark)(l).then(function(t){t&&1===t.code?(r=!0,n&&r&&e()):f["default"].error(t.message)})}else e();else f["default"].error(t.message)})}else if(a.remark){r=!1;var d=j.queryString({machineId:i,type:1,remark:a.remark});(0,M.saveRemark)(d).then(function(t){t&&1===t.code?(r=!0,n&&r&&e()):f["default"].error(t.message)})}else e()})},a.handleBack=function(){a.saveWeightAndRemark(function(){B["default"].goBack()})},a.handlePrint=function(){a.saveWeightAndRemark(function(){var e=a.props.form.validateFields,t=a.props.location.query.machineId,i=a.state,n=i.detail;i.deductWeight;e(["deviceId","inFactoryWeight","outFactoryWeight","deductWeight","remark"],function(e,a){if(!e){var i={machineId:t,type:1,remark:a.remark?a.remark:"",deductWeight:a.deductWeight?a.deductWeight:void 0,deviceId:a.deviceId,deliveryCompany:n.deliveryCompany,driver:n.driver,productId:n.productId,productName:n.productName,trainNumber:n.trainNumber,inFactoryWeight:n.inFactoryWeight,outFactoryWeight:n.outFactoryWeight,netWeight:(n.inFactoryWeight-n.outFactoryWeight-(a.deductWeight||0)).toFixed(2)};(0,M.printPoundSheet)(i).then(function(e){e&&1===e.code?f["default"].success(e.message):f["default"].error(e.message)})}})})},a.handleOk=function(){var e=a.props.form.validateFields,t=a.props.location.query.machineId;e(["deductWeight","remark"],function(e,a){e||(0,M.continueMachine)({machineId:t,type:1,deductWeight:a.deductWeight||0===a.deductWeight?a.deductWeight:void 0,remark:a.remark?a.remark:void 0}).then(function(e){e&&1===e.code?(f["default"].success(e.message),B["default"].goBack()):f["default"].error(e.message)})})},a.handleCancel=function(){var e=a.props.form.validateFields,t=a.props.location.query.machineId;e(["deductWeight","remark"],function(e,a){e||(0,M.confirmMachine)({machineId:t,type:1,deductWeight:a.deductWeight||0===a.deductWeight?a.deductWeight:void 0,remark:a.remark?a.remark:void 0}).then(function(e){e&&1===e.code?(f["default"].success(e.message),B["default"].goBack()):f["default"].error(e.message)})})},a}return(0,W["default"])(t,e),(0,g["default"])(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.location.query.machineId;(0,M.getWeightSelectList)().then(function(t){t&&1===t.code&&e.setState({devices:t.object})});var a=j.queryString({machineId:t,type:1});(0,M.getWeightMachineWebDeatil)(a).then(function(t){t&&1===t.code&&e.setState({detail:t.object,inHaveConfirm:!!t.object.inFactoryWeightIsConfirm,inButtonState:t.object.inFactoryWeightIsConfirm?2:t.object.inFactoryWeight?1:0,inFactoryWeightByManual:t.object.inFactoryWeightByManual||0,inFactoryWeight:t.object.inFactoryWeight||0===t.object.inFactoryWeight?t.object.inFactoryWeight:null,outHaveConfirm:!!t.object.outFactoryWeightIsConfirm,outButtonState:t.object.outFactoryWeightIsConfirm?2:t.object.outFactoryWeight?1:0,outFactoryWeightByManual:t.object.outFactoryWeightByManual||0,outFactoryWeight:t.object.outFactoryWeight||0===t.object.outFactoryWeight?t.object.outFactoryWeight:null,deductWeight:t.object.deductWeight||null,remark:t.object.remark||null,samplePushStatus:t.object.samplePushStatus||0,deviceId:t.object.deviceId||null})})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.state,i=a.detail,n=a.devices,f=a.inHaveConfirm,h=a.inButtonState,s=a.inFactoryWeight,m=a.outHaveConfirm,g=a.outButtonState,y=a.outFactoryWeight,p=a.deductWeight,W=a.remark,v=a.samplePushStatus,F=a.deviceId;return r["default"].createElement("div",{className:I["default"].container},r["default"].createElement(l["default"],{title:"\u8fc7\u78c5\u8f66\u8f86",bordered:!1,extra:r["default"].createElement(o["default"],{onClick:this.handleSample.bind(this),disabled:!!v,type:"primary",icon:"sound"},"\u901a\u77e5\u53d6\u6837")},r["default"].createElement("div",{className:I["default"].formPart},r["default"].createElement("span",{className:I["default"].partTitle},"\u8f66\u8f86\u4fe1\u606f"),r["default"].createElement(S["default"],{layout:"inline"},r["default"].createElement(q,{label:"\u8f66\u724c\u53f7"},i.trainNumber||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u53f8\u673a"},i.driver||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u8054\u7cfb\u65b9\u5f0f"},i.contact||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u627f\u8fd0\u65b9"},i.carrierName||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u53d1\u8d27\u5355\u4f4d"},i.deliveryCompany||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u4ea7\u54c1\u540d\u79f0"},i.productName||"\u672a\u77e5"))),r["default"].createElement(c["default"],null),r["default"].createElement("div",{className:I["default"].formPart},r["default"].createElement("span",{className:I["default"].partTitle},"\u79f0\u91cd\u4fe1\u606f"),r["default"].createElement(S["default"],null,r["default"].createElement(q,{label:"\u79f0\u91cd\u8bbe\u5907"},t("deviceId",{initialValue:F,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u79f0\u91cd\u8bbe\u5907"}]})(r["default"].createElement(b["default"],{style:{width:"80%"},placeholder:"\u8bf7\u9009\u62e9\u79f0\u91cd\u8bbe\u5907"},n.map(function(e,t){return r["default"].createElement(w,{value:e.deviceId,key:e.deviceId},e.name)})))),r["default"].createElement(q,{label:"\u8fdb\u5382\u6570\u91cf"},t("inFactoryWeight",{initialValue:s,rules:[{required:!0,message:"\u8bf7\u79f0\u91cd"}]})(r["default"].createElement(u["default"],{disabled:3!==h,precision:2,style:{width:"60%"},placeholder:"\u8bf7\u79f0\u91cd",onChange:function(t){return e.setState({inFactoryWeight:t})}})),0===h?r["default"].createElement(o["default"],{onClick:this.getWeight.bind(this,"in"),type:"primary",style:{marginLeft:24}},"\u8fdb\u5382\u79f0\u91cd"):1===h?r["default"].createElement(o["default"],{onClick:this.handleWeight.bind(this,1),type:"primary",style:{marginLeft:24}},"\u786e\u8ba4\u79f0\u91cd"):2===h?r["default"].createElement(o["default"],{onClick:function(){return e.setState({inButtonState:3,inFactoryWeightByManual:1})},type:"primary",style:{marginLeft:24}},"\u624b\u52a8\u4fee\u6539"):3===h?r["default"].createElement(o["default"],{onClick:this.handleWeight.bind(this,1),type:"primary",style:{marginLeft:24}},"\u786e\u8ba4\u79f0\u91cd"):null),r["default"].createElement(q,{label:"\u51fa\u5382\u6570\u91cf"},t("outFactoryWeight",{initialValue:y,rules:[{required:!0,message:"\u8bf7\u79f0\u91cd"}]})(r["default"].createElement(u["default"],{disabled:3!==g,precision:2,style:{width:"60%"},placeholder:"\u8bf7\u79f0\u91cd",onChange:function(t){return e.setState({outFactoryWeight:t})}})),0===g?r["default"].createElement(o["default"],{onClick:this.getWeight.bind(this,"out"),type:"primary",style:{marginLeft:24}},"\u51fa\u5382\u79f0\u91cd"):1===g?r["default"].createElement(o["default"],{onClick:this.handleWeight.bind(this,2),type:"primary",style:{marginLeft:24}},"\u786e\u8ba4\u79f0\u91cd"):2===g?r["default"].createElement(o["default"],{onClick:function(){return e.setState({outButtonState:3,outFactoryWeightByManual:1})},type:"primary",style:{marginLeft:24}},"\u624b\u52a8\u4fee\u6539"):3===g?r["default"].createElement(o["default"],{onClick:this.handleWeight.bind(this,2),type:"primary",style:{marginLeft:24}},"\u786e\u8ba4\u79f0\u91cd"):null),r["default"].createElement(q,{label:"\u6263\u91cd\u6570\u91cf"},t("deductWeight",{initialValue:p||null})(r["default"].createElement(u["default"],{style:{width:"80%"},precision:2,placeholder:"\u8bf7\u8f93\u5165\u6263\u91cd\u6570\u91cf",onChange:function(t){return e.setState({deductWeight:t})}}))),r["default"].createElement(q,{label:"\u51c0\u91cd"},s&&y?(s-y-(p||0)).toFixed(2):"\u65e0"),r["default"].createElement(q,{label:"\u5b9e\u9645\u5230\u5382\u65f6\u95f4"},i.arrivalTime||"\u672a\u77e5"),r["default"].createElement(q,{label:"\u5907\u6ce8"},t("remark",{initialValue:W||null})(r["default"].createElement(N,{style:{width:"80%"},autoSize:{minRows:4,maxRows:4}}))))),r["default"].createElement("div",{className:I["default"].footer},r["default"].createElement(o["default"],{onClick:this.handleBack.bind(this),style:{marginRight:24}},"\u8fd4\u56de"),r["default"].createElement(o["default"],{disabled:!f||!m,onClick:this.handlePrint.bind(this),type:"primary",style:{marginRight:24}},"\u6253\u5370\u78c5\u5355"),r["default"].createElement(d["default"],{placement:"topLeft",title:"\u662f\u5426\u7ee7\u7eed\u8fd0\u8f7d\u8d27\u7269?",onConfirm:this.handleOk,onCancel:this.handleCancel,okText:"\u7ee7\u7eed\u8fd0\u8f7d",cancelText:"\u7ed3\u675f\u8fd0\u8f7d",disabled:!f||!m||!v},r["default"].createElement(o["default"],{disabled:!f||!m||!v,type:"primary"},"\u63d0\u4ea4")))))}}]),t}(r.Component),k=E))||k)||k);t["default"]=P},ZVTz:function(e,t,a){e.exports={container:"container___1aKjK",formPart:"formPart___gxHtZ",partTitle:"partTitle___1Sdy7",footer:"footer___3Zsvx"}}}]);